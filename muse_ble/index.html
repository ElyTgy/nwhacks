

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muse 2 Web Bluetooth</title>
</head>
<body>
    <h1>Muse 2 Web Bluetooth</h1>
    <button id="connectButton">Connect to Muse 2</button>
    <p id="status">Not connected</p>
   
    <script>
        async function connectMuse2() {
            try {
                const device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true, // Accepts all BLE devices
                    optionalServices: ['0000fe8d-0000-1000-8000-00805f9b34fb'] // Muse 2 BLE Service UUID
                });

                document.getElementById("status").textContent = `Connected to: ${device.name}`;
                console.log("Connected to:", device.name);

                const server = await device.gatt.connect();
                const service = await server.getPrimaryService('0000fe8d-0000-1000-8000-00805f9b34fb');

                console.log("Service discovered:", service);
                document.getElementById("status").textContent = "Connected & Service found";

                return { device, server, service };
            } catch (error) {
                console.error("Error connecting to Muse 2:", error);
                document.getElementById("status").textContent = "Connection failed";
            }
        }

        async function startEEGStream(service) {
            try {
                const characteristic = await service.getCharacteristic('273e0003-4c4d-454d-96be-f03bac821358');
                await characteristic.startNotifications();

                characteristic.addEventListener('characteristicvaluechanged', (event) => {
                    const value = new Uint8Array(event.target.value.buffer);
                    console.log("EEG Data Received:", value);
                    document.getElementById("status").textContent = "Receiving EEG data";
                });

                console.log("Subscribed to EEG data stream");
            } catch (error) {
                console.error("Error subscribing to EEG data:", error);
                document.getElementById("status").textContent = "Failed to start EEG stream";
            }
        }

        document.getElementById("connectButton").addEventListener("click", async () => {
            let { service } = await connectMuse2();
            if (service) {
                await startEEGStream(service);
            }
        });
    </script>
</body>
</html>
